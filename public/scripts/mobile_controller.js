// Generated by CoffeeScript 1.6.3
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  window.MobileController = (function() {
    function MobileController(header, ref) {
      this.header = header;
      this.ref = ref != null ? ref : null;
      this.onResize = __bind(this.onResize, this);
      this.closeStoreTab = __bind(this.closeStoreTab, this);
      this.openStore = __bind(this.openStore, this);
      this.closeStore = __bind(this.closeStore, this);
      this.setMobileInteractions = __bind(this.setMobileInteractions, this);
      this.setHeaderInteraction = __bind(this.setHeaderInteraction, this);
      this.body = $('body');
      this.mobile_toolbar = this.header.find('.action-bar-mobile');
      this.store_mobile_btn = this.mobile_toolbar.find('a.store');
      this.map_mobile_btn = this.mobile_toolbar.find('a.map');
      this.header_open_btn = this.header.find('.btn-menu');
      this.has_toolbar = this.ref.length === 1 ? true : false;
      this.header_height = this.header.height();
      if (this.has_toolbar) {
        this.general_content = this.ref.find('.toolbar-content');
        this.stores_content = this.general_content.find('.stores-content');
        this.filter_close_btn = this.stores_content.find('.close-filter');
        this.stores_content_c = this.stores_content.find('#content');
        this.stores_content_searchResult = this.stores_content.find('#content #wrapSearchResult');
        this.stores_content_filterList = this.stores_content.find('#content #wrapFilterList');
        this.search = this.stores_content.find('.search-wrapper');
        this.search_height = parseInt(this.search.css('height'));
        this.stores_content_filterList.show();
        this.stores_content.show();
        this.setMobileInteractions();
      }
      this.setHeaderInteraction();
      event_emitter.addListener('CLOSE_STORE_TAB', this.closeStoreTab);
    }

    MobileController.prototype.setHeaderInteraction = function() {
      var _this = this;
      return this.header_open_btn.click(function(e) {
        var filter_is_open, store_is_open;
        e.preventDefault();
        _this.body.toggleClass('menu-opened');
        event_emitter.emitEvent('RESIZE_ALL');
        if (_this.has_toolbar) {
          store_is_open = _this.stores_content_searchResult.hasClass('open');
          filter_is_open = _this.stores_content_filterList.hasClass('open');
          if (store_is_open || filter_is_open) {
            return _this.manual_menu = true;
          } else {
            return _this.manual_menu = false;
          }
        }
      });
    };

    MobileController.prototype.setMobileInteractions = function() {
      var _this = this;
      this.map_mobile_btn.click(function(e) {
        var map_mobile_btn;
        e.preventDefault();
        map_mobile_btn = $(e.currentTarget);
        map_mobile_btn.addClass('active');
        return _this.closeStore();
      });
      this.store_mobile_btn.click(function(e) {
        e.preventDefault();
        return _this.openStore();
      });
      return this.stores_content_searchResult.get(0).addEventListener('webkitTransitionEnd', (function(e) {
        var store_is_open, _stores_content_searchResult;
        e.stopPropagation();
        _stores_content_searchResult = $(e.currentTarget);
        store_is_open = _stores_content_searchResult.hasClass('open');
        if (!store_is_open) {
          return _this.ref.removeClass('open-content');
        }
      }), false);
    };

    MobileController.prototype.closeStore = function() {
      var _this = this;
      this.store_mobile_btn.removeClass('active');
      return this.stores_content_c.show("fast", function() {
        var body_has_menu;
        _this.ref.addClass('open-content');
        body_has_menu = _this.body.hasClass('menu-opened');
        _this.stores_content_searchResult.removeClass('open');
        if (body_has_menu && !_this.manual_menu) {
          _this.body.removeClass('menu-opened');
        } else {
          _this.manual_menu = false;
        }
        if (typeof store_list_iscroll !== "undefined" && store_list_iscroll !== null) {
          return store_list_iscroll.refresh();
        }
      });
    };

    MobileController.prototype.openStore = function() {
      var _this = this;
      this.store_mobile_btn.addClass('active');
      return this.stores_content_c.show("fast", function() {
        var body_has_menu;
        _this.ref.addClass('open-content');
        body_has_menu = _this.body.hasClass('menu-opened');
        _this.stores_content_searchResult.addClass('open');
        if (_this.map_mobile_btn.hasClass('active')) {
          _this.map_mobile_btn.removeClass('active');
        }
        if (body_has_menu && !_this.manual_menu) {
          _this.body.removeClass('menu-opened');
        } else {
          _this.manual_menu = false;
        }
        if (typeof store_list_iscroll !== "undefined" && store_list_iscroll !== null) {
          return store_list_iscroll.refresh();
        }
      });
    };

    MobileController.prototype.closeStoreTab = function() {
      return this.map_mobile_btn.click();
    };

    MobileController.prototype.onResize = function(window_w, window_h) {
      var height_to_assign;
      if (this.has_toolbar) {
        height_to_assign = window_h - this.header_height - this.search_height;
        this.stores_content_c.css('height', "" + height_to_assign + "px");
        this.stores_content_searchResult.css('height', "" + height_to_assign + "px");
        return this.stores_content_filterList.css('height', "" + height_to_assign + "px");
      }
    };

    return MobileController;

  })();

}).call(this);
